<div class="reader-wrap">
  <div class="toolbar">
    <button (click)="speakAll()">🔊 Play all</button>
    <button (click)="pause()">⏸️ Pause</button>
    <button (click)="resume()">▶️ Resume</button>
    <button (click)="stop()">⏹️ Stop</button>
    <span class="lang-tag">{{ toLangToBcp47() }}</span>
  </div>

  <div class="columns">
    <div class="left">
      <label>Source language</label>
      <select [(ngModel)]="fromLang">
        <option value="en">English</option>
        <option value="fr">French</option>
        <option value="es">Spanish</option>
        <option value="de">German</option>
        <option value="hi">Hindi</option>
      </select>

      <label>Target language</label>
      <select [(ngModel)]="toLang">
        <option value="en">English</option>
        <option value="fr">French</option>
        <option value="es">Spanish</option>
        <option value="de">German</option>
        <option value="hi">Hindi</option>
      </select>

      <label>Paste your paragraph</label>
      <textarea [(ngModel)]="sourceText" rows="9"></textarea>

      <button class="cta" (click)="doTranslate()">Translate →</button>
    </div>

    <div
      class="right"
      (mouseup)="mouseUpSelection()"
      (click)="clickToken($event)"
    >
      <ng-container *ngFor="let t of tokens">
        <span *ngIf="isWord(t); else plainText" class="tok word">
          <span class="w">{{ t.text }}</span>
          <button
            class="speak-word"
            type="button"
            aria-label="Speak word"
            (mousedown)="$event.preventDefault(); $event.stopPropagation()"
            (click)="speakWord(t.text); $event.stopPropagation();"
          >
            🔊
          </button>
        </span>

        <ng-template #plainText>{{ t.text }}</ng-template>
      </ng-container>
    </div>
  </div>

  <app-popup-translation
    *ngIf="popup.visible"
    [x]="popup.x"
    [y]="popup.y"
    [text]="popup.text"
    [translation]="popup.translation"
    [perWord]="popup.perWord || []"
    (speak)="speakWord(popup.text)"
    (speakWord)="speakWord($event)"
    (close)="hidePopup()"
    (markKnown)="markKnown()"
  >
  </app-popup-translation>
</div>
