<div class="reader-wrap">
  <div class="toolbar">
    <button (click)="speakAll()">üîä Play all</button>
    <button (click)="pause()">‚è∏Ô∏è Pause</button>
    <button (click)="resume()">‚ñ∂Ô∏è Resume</button>
    <button (click)="stop()">‚èπÔ∏è Stop</button>
    <span class="lang-tag">{{ toLangToBcp47() }}</span>
  </div>

  <div class="columns">
    <div class="left">
      <label>Source language</label>
      <select [(ngModel)]="fromLang">
        <option value="en">English</option>
        <option value="fr">French</option>
        <option value="es">Spanish</option>
        <option value="de">German</option>
        <option value="hi">Hindi</option>
      </select>

      <label>Target language</label>
      <select [(ngModel)]="toLang">
        <option value="en">English</option>
        <option value="fr">French</option>
        <option value="es">Spanish</option>
        <option value="de">German</option>
        <option value="hi">Hindi</option>
      </select>

      <label>Paste your paragraph</label>
      <textarea [(ngModel)]="sourceText" rows="9"></textarea>

      <button class="cta" (click)="doTranslate()">Translate ‚Üí</button>
    </div>

    <div
      class="right"
      (mouseup)="mouseUpSelection()"
      (click)="clickToken($event)"
    >
      <ng-container *ngFor="let t of tokens; let i = index">
        <!-- render both words and plain tokens inside a .tok so highlighting covers spaces/punctuation too -->
        <span class="tok" [attr.data-index]="i">
          <span class="w" [innerText]="t.text"></span>
        </span>
      </ng-container>
    </div>
  </div>

<!-- ...existing code... -->

<!-- Big popup (word click OR sentence selection) -->
<app-popup-translation
  *ngIf="popup.visible"
  [visible]="popup.visible"
  [x]="popup.x"
  [y]="popup.y"
  [original]="popup.original"
  [translation]="popup.translation"
  [isWordPopup]="popup.isWordPopup"
  (speak)="popup.isWordPopup ? speakWord(popup.original) : speakTranslation()"
  (markKnown)="markKnown()"
  (close)="hidePopup()"
  (pickWord)="onPopupPickWord($event)"  
></app-popup-translation>

<!-- Mini popup (only translation + speaker, anchored to the word location) -->
<app-popup-translation
  *ngIf="miniPopup.visible"
  [visible]="miniPopup.visible"
  [x]="miniPopup.x"
  [y]="miniPopup.y"
  [original]="' '"                 
  [translation]="miniPopup.translation"
  [isWordPopup]="false"
  (speak)="speakMini()"
></app-popup-translation>

<!-- Multiple small popups for each selected token/segment -->
<ng-container *ngFor="let sp of selectionPopups">
  <app-popup-translation
    *ngIf="sp.visible"
    [visible]="sp.visible"
    [x]="sp.x"
    [y]="sp.y"
    [original]="sp.word"
    [translation]="sp.translation"
    [isWordPopup]="false"
    (speak)="speakMini()"
  ></app-popup-translation>
</ng-container>


</div>
