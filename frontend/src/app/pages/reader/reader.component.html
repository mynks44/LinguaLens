<div class="reader-wrap">
  <div class="toolbar">
    <button (click)="speakAll()">ğŸ”Š Play all</button>
    <button (click)="pause()">â¸ï¸ Pause</button>
    <button (click)="resume()">â–¶ï¸ Resume</button>
    <button (click)="stop()">â¹ï¸ Stop</button>
    <span class="lang-tag">{{ toLangToBcp47() }}</span>
  </div>

  <div class="columns">
    <div class="left">
      <label>Source language</label>
      <select [(ngModel)]="fromLang">
        <option value="en">English</option>
        <option value="fr">French</option>
        <option value="es">Spanish</option>
        <option value="de">German</option>
        <option value="hi">Hindi</option>
      </select>

      <label>Target language</label>
      <select [(ngModel)]="toLang">
        <option value="en">English</option>
        <option value="fr">French</option>
        <option value="es">Spanish</option>
        <option value="de">German</option>
        <option value="hi">Hindi</option>
      </select>

      <label>Paste your paragraph</label>
      <textarea [(ngModel)]="sourceText" rows="9"></textarea>

      <button class="cta" (click)="doTranslate()">Translate â†’</button>
    </div>

    <div
      class="right"
      (mouseup)="mouseUpSelection()"
      (click)="clickToken($event)"
    >
      <ng-container *ngFor="let t of tokens">
        <span *ngIf="isWord(t); else plainText" class="tok word">
          <span class="w">{{ t.text }}</span>
          <button
            class="speak-word"
            type="button"
            aria-label="Speak word"
            (mousedown)="$event.preventDefault(); $event.stopPropagation()"
            (click)="speakWord(t.text); $event.stopPropagation();"
          >
            ğŸ”Š
          </button>
        </span>
        <ng-template #plainText>{{ t.text }}</ng-template>
      </ng-container>
    </div>
  </div>

<!-- ... your toolbar + columns + tokens ... -->

<!-- Big popup (word click OR sentence selection) -->
<app-popup-translation
  *ngIf="popup.visible"
  [visible]="popup.visible"
  [x]="popup.x"
  [y]="popup.y"
  [original]="popup.original"
  [translation]="popup.translation"
  [isWordPopup]="popup.isWordPopup"
  (speak)="popup.isWordPopup ? speakWord(popup.original) : speakTranslation()"
  (markKnown)="markKnown()"
  (close)="hidePopup()"
  (pickWord)="onPopupPickWord($event)"  
></app-popup-translation>

<!-- Mini popup (only translation + speaker, anchored to the word location) -->
<app-popup-translation
  *ngIf="miniPopup.visible"
  [visible]="miniPopup.visible"
  [x]="miniPopup.x"
  [y]="miniPopup.y"
  [original]="' '"                 
  [translation]="miniPopup.translation"
  [isWordPopup]="false"
  (speak)="speakMini()"
></app-popup-translation>

<!-- Multiple small popups for each selected token/segment -->
<ng-container *ngFor="let sp of selectionPopups">
  <app-popup-translation
    *ngIf="sp.visible"
    [visible]="sp.visible"
    [x]="sp.x"
    [y]="sp.y"
    [original]="sp.word"
    [translation]="sp.translation"
    [isWordPopup]="false"
    (speak)="speakMini()"
  ></app-popup-translation>
</ng-container>


</div>
