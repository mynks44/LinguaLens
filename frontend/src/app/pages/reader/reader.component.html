<div class="reader-wrap" (mouseup)="mouseUpSelection()">
  <div class="toolbar">
    <button (click)="speakAll()">Play all</button>
    <button (click)="pause()">Pause</button>
    <button (click)="resume()">Resume</button>
    <span class="lang-tag">Target: {{ toLang }}</span>
  </div>

  <div class="columns">
    <div class="left">
      <app-language-select
        label="Source language"
        [value]="fromLang"
        [excludeValue]="toLang"
        (valueChange)="fromLang = $event"
      ></app-language-select>

      <app-language-select
        label="Target language"
        [value]="toLang"
        [excludeValue]="fromLang"
        (valueChange)="toLang = $event"
      ></app-language-select>

      <label class="mt-2">Paste your paragraph</label>
      <textarea
        rows="8"
        [(ngModel)]="sourceText"
      ></textarea>

      <button class="cta" (click)="doTranslate()">Translate â†’</button>
    </div>

    <div
      class="right"
      #readerContainer
    >
      <ng-container *ngFor="let t of tokens">
        <span
          *ngIf="t.kind === 'word'; else nonWord"
          class="tok word"
          (click)="clickToken($event)"
        >
          <span class="w">{{ t.text }}</span>
        </span>

        <ng-template #nonWord>
          <span class="tok">{{ t.text }}</span>
        </ng-template>
      </ng-container>
    </div>
  </div>

  <!-- main popup (word or sentence) -->
  <app-popup-translation
    [visible]="popup.visible"
    [x]="popup.x"
    [y]="popup.y"
    [original]="popup.original"
    [translation]="popup.translation"
    [isWordPopup]="popup.isWordPopup"
    (speak)="speakTranslation()"
    (markKnown)="markKnown()"
    (close)="hidePopup()"
    (pickWord)="onPopupPickWord($event)"
  ></app-popup-translation>

  <!-- mini popup for single word inside sentence -->
  <div
    class="mini-popup"
    *ngIf="miniPopup.visible"
    [ngStyle]="{ left: miniPopup.x + 'px', top: miniPopup.y + 'px' }"
    (click)="$event.stopPropagation()"
  >
    <span class="mini-text">{{ miniPopup.translation }}</span>
    <button class="mini-speak" (click)="speakMini()">ðŸ”Š</button>
    <span class="arrow" aria-hidden="true"></span>
  </div>
</div>
