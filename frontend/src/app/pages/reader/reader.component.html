<div class="reader-wrap">
  <div class="toolbar">
    <button (click)="speakAll()">🔊 Play all</button>
    <button (click)="pause()">⏸️ Pause</button>
    <button (click)="resume()">▶️ Resume</button>
    <button (click)="stop()">⏹️ Stop</button>
    <span class="lang-tag">{{ toLangToBcp47() }}</span>
  </div>

  <div class="columns">
    <div class="left">
      <label>Source language</label>
      <select [(ngModel)]="fromLang">
        <option value="en">English</option>
        <option value="fr">French</option>
        <option value="es">Spanish</option>
        <option value="de">German</option>
        <option value="hi">Hindi</option>
      </select>

      <label>Target language</label>
      <select [(ngModel)]="toLang">
        <option value="en">English</option>
        <option value="fr">French</option>
        <option value="es">Spanish</option>
        <option value="de">German</option>
        <option value="hi">Hindi</option>
      </select>

      <label>Paste your paragraph</label>
      <textarea [(ngModel)]="sourceText" rows="9"></textarea>

      <button class="cta" (click)="doTranslate()">Translate →</button>
    </div>

    <div
      class="right"
      (mouseup)="mouseUpSelection()"
      (click)="clickToken($event)"
    >
      <ng-container *ngFor="let t of tokens">
        <span *ngIf="isWord(t); else plainText" class="tok word">
          <span class="w">{{ t.text }}</span>
        </span>

        <ng-template #plainText>{{ t.text }}</ng-template>
      </ng-container>

      <div
        *ngFor="let b of balloons"
        class="balloon"
        [style.left.px]="b.x"
        [style.top.px]="b.y"
        (mousedown)="$event.stopPropagation()"
        (click)="speakWord(b.src)"
        title="{{ b.src }} → {{ b.dst }}"
      >
        <span class="balloon-text">{{ b.dst }}</span>
        <span class="balloon-icon" aria-hidden="true">🔊</span>
        <span class="arrow" aria-hidden="true"></span>
      </div>
    </div>
  </div>

  <app-popup-translation
    *ngIf="popup.visible"
    [x]="popup.x"
    [y]="popup.y"
    [text]="popup.text"
    [translation]="popup.translation"
    (speak)="speakWord(popup.text)"
    (close)="hidePopup()"
    (markKnown)="markKnown()"
  >
  </app-popup-translation>
</div>
