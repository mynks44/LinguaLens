<div class="cloud" *ngIf="visible" [style.left.px]="computedLeft" [style.top.px]="computedTop">
  <!-- SVG connector: thin curved stroke with arrow marker that visually links bubble to target token -->
  <svg *ngIf="visible && svgWidth > 0 && svgHeight > 0" class="tail-svg" [attr.width]="svgWidth" [attr.height]="svgHeight" [style.left.px]="svgLeft" [style.top.px]="svgTop" preserveAspectRatio="none" aria-hidden="true">
    <defs>
      <!-- arrow marker: tip aligned with path end (refX at right side), keep size in user space for consistent look -->
      <!-- smaller arrow marker: tip aligned with path end (refX at right side of viewBox) -->
      <marker id="cloud-arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto" markerUnits="userSpaceOnUse" viewBox="0 0 8 8">
        <!-- compact triangle sized 8x8 so it doesn't overpower the connector line -->
        <path d="M0,0 L8,4 L0,8 z" fill="#000" />
      </marker>
    </defs>
    <path [attr.d]="tailPath" class="tail-path" [attr.marker-end]="'url(#cloud-arrow)'" />
    <!-- removed the white blend mask circle to avoid an extra rounded artifact on the bubble -->
  </svg>

  <div class="bubble" #bubble [style.maxWidth.px]="maxWidth">
    <div class="text">
      <div class="orig" *ngIf="original && original.trim()">{{ original }}</div>
      <div class="trans" *ngIf="(translation && translation.trim()) || (text && text.trim())">{{ (translation && translation.trim()) ? translation : text }}</div>
    </div>
    <div class="actions">
      <button class="speak" (click)="onSpeak()">ðŸ”Š</button>
    </div>
  </div>
</div>
