<div
  class="popup"
  *ngIf="visible"
  [ngStyle]="{ left: x + 'px', top: y + 'px' }"
  (click)="$event.stopPropagation()"
>
  <div class="card">
    <span class="arrow" aria-hidden="true"></span>

    <!-- ORIGINAL TEXT (word or sentence) -->
    <div class="orig" *ngIf="original">
      <!-- Sentence popup: each word clickable to spawn mini popup -->
      <ng-container *ngIf="!isWordPopup; else singleWord">
        <ng-container *ngFor="let w of originalWords; let i = index">
          <button
            type="button"
            class="orig-word-btn"
            (click)="onSentenceWordClick(w, $event)"
          >
            {{ w }}
          </button>
          <span *ngIf="i < originalWords.length - 1"> </span>
        </ng-container>
      </ng-container>

      <!-- Word popup: just plain word -->
      <ng-template #singleWord>
        {{ original }}
      </ng-template>
    </div>

    <!-- TRANSLATION + SPEAKER -->
    <div class="row">
      <div class="translation">
        {{ translation }}
      </div>
      <button
        type="button"
        class="speak-btn"
        (click)="speak.emit()"
        aria-label="Speak translation"
        title="Speak translation"
      >
        ðŸ”Š
      </button>
    </div>

    <!-- WORD POPUP ACTIONS ONLY -->
    <div class="actions" *ngIf="isWordPopup">
      <button type="button" (click)="markKnown.emit()">Mark known</button>
      <button type="button" (click)="close.emit()">Close</button>
    </div>
  </div>
</div>
