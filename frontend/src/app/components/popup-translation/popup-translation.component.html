<div
  class="popup"
  *ngIf="visible"
  [ngStyle]="{ left: x + 'px', top: y + 'px' }"
  (mousedown)="$event.stopPropagation()"
  (click)="$event.stopPropagation()"
>
  <div class="card">
    <!-- ORIGINAL (word or sentence) -->
    <div class="orig" *ngIf="original" (mouseup)="onOrigMouseUp($event)">
      {{ original }}
    </div>

    <!-- TRANSLATION + SPEAKER -->
    <div class="row">
      <div class="translation">{{ translation }}</div>
      <button
        class="speak-btn"
        type="button"
        (click)="speak.emit()"
        aria-label="Speak translation"
        title="Speak translation"
      >ðŸ”Š</button>
    </div>

    <!-- Optional mini gloss chips (if you provide perWord) -->
    <div class="mini-gloss" *ngIf="perWord.length">
      <button
        class="chip"
        type="button"
        *ngFor="let g of perWord"
        (click)="onChipClick(g.src)"
        [title]="g.src + ' â†’ ' + g.dst"
      >
        <b class="src">{{ g.src }}</b>
        <span class="sep">â€”</span>
        <span class="dst">{{ g.dst }}</span>
        <span aria-hidden="true" class="icon">ðŸ”Š</span>
      </button>
    </div>

    <!-- Actions ONLY for word popup -->
    <div class="actions" *ngIf="isWordPopup">
      <button type="button" (click)="speak.emit()">Speak</button>
      <button type="button" (click)="markKnown.emit()">Mark known</button>
      <button type="button" (click)="close.emit()">Close</button>
    </div>

    <span class="arrow" aria-hidden="true"></span>
  </div>
</div>
